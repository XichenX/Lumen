name: Publish to JitPack

on:
  push:
    tags:
      - 'v*'  # å½“æ¨é€ä»¥ v å¼€å¤´çš„ tag æ—¶è§¦å‘
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  notify-jitpack:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Extract version from tag
        id: extract_version
        if: github.event_name == 'push'
        run: |
          VERSION=${GITHUB_REF#refs/tags/v}
          echo "version=$VERSION" >> $GITHUB_OUTPUT
          echo "Tag version: $VERSION"
      
      - name: Notify JitPack
        run: |
          echo "ğŸ“¦ JitPack will automatically build and publish this release"
          echo "Visit https://jitpack.io/#XichenX/Lumen/${{ steps.extract_version.outputs.version }}"
          echo ""
          echo "JitPack will automatically:"
          echo "1. Detect the new tag"
          echo "2. Build all modules (lumen-core, lumen-view, lumen-transform, lumen)"
          echo "3. Publish to JitPack repository"
          echo ""
          echo "Users can use:"
          echo "  implementation(\"com.github.XichenX:Lumen:v${{ steps.extract_version.outputs.version }}\")"
      
      - name: Create GitHub Release
        if: github.event_name == 'push'
        uses: softprops/action-gh-release@v1
        with:
          tag_name: ${{ github.ref }}
          name: JitPack Release v${{ steps.extract_version.outputs.version }}
          body: |
            ## ğŸ“¦ JitPack è‡ªåŠ¨å‘å¸ƒ
            
            JitPack ä¼šè‡ªåŠ¨æ„å»ºå¹¶å‘å¸ƒæ­¤ç‰ˆæœ¬ã€‚
            
            ### ğŸ“‹ Published Modules
            
            - âœ… **lumen-core** - Core loading logic
            - âœ… **lumen-view** - ImageView and Compose support
            - âœ… **lumen-transform** - Image transformation features
            - âœ… **lumen** - Aggregated module (includes all sub-modules)
            
            ### ğŸš€ Usage
            
            ```kotlin
            repositories {
                maven { url = uri("https://jitpack.io") }
            }
            
            dependencies {
                // èšåˆæ¨¡å—ï¼ˆæ¨èï¼‰- è‡ªåŠ¨åŒ…å«æ‰€æœ‰å­æ¨¡å—
                implementation("com.github.XichenX:Lumen:v${{ steps.extract_version.outputs.version }}")
                
                // æˆ–ç‹¬ç«‹æ¨¡å—
                implementation("com.github.XichenX:lumen-core:v${{ steps.extract_version.outputs.version }}")
                implementation("com.github.XichenX:lumen-view:v${{ steps.extract_version.outputs.version }}")
                implementation("com.github.XichenX:lumen-transform:v${{ steps.extract_version.outputs.version }}")
            }
            ```
            
            ### ğŸ“Š Build Status
            
            [JitPack Build Status](https://jitpack.io/#XichenX/Lumen/${{ steps.extract_version.outputs.version }})
            
            ### â±ï¸ Build Time
            
            JitPack usually takes 5-10 minutes to build. Check the link above for status.
          draft: false
          prerelease: false
          generate_release_notes: true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

